function menuSlide(){new Swiper(".swiper-container",{pagination:".swiper-pagination",slidesPerView:3,preventClicks:!1,prevButton:".btn-prev",nextButton:".btn-next",spaceBetween:30})}function popup_middle(t){var e=$(window).scrollTop(),n=$(window).height(),s=$(window).width(),i=t.height(),a=t.width(),r=(n-i)/2+e,u=(s-a)/2;t.css({left:u+"px",top:r+"px",display:"block"})}if(window.location.hash){var Urlhash=window.location.hash,rId=Urlhash.slice(1,Urlhash.length),token=store.get("wxToken");$.ajax({type:"get",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/restaurant/"+rId+"/menu/get",dataType:"json",success:function(t){function e(t){for(var e="",n=i[t].menuDishResponseList,s=0;s<n.length;s++)e+='<li class="menu-items"><img src="'+n[s].previewUrl+'" alt=""><h3 class="menu-title">'+n[s].name+'</h3><p><em>¥</em> <em class="menu-price">'+n[s].price+'</em> <a href="javascript:;" class="btn-plus" mid="'+n[s].id+'" did="'+n[s].dishId+'">+</a> <strong class="menu-num">0</strong> <a href="javascript:;" class="btn-minus" mid="'+n[s].id+'" did="'+n[s].dishId+'">-</a></p></li>';return e}function n(t){$(".swiper-slide").removeClass("cur"),$(".swiper-slide").eq(t).addClass("cur"),$("#menu_list").html(e(t)),$("#menu_sum").html($("#menu_list li").length)}function s(t,e,n){var s={menuItemId:t,dishId:e,quantity:n,restaurantId:rId,platformId:3};$.ajax({type:"post",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/add",data:JSON.stringify(s),dataType:"json",succees:function(t){},error:function(){}})}if(t.succeed){var i=t.value.menuClassifyResponseList;if(0==i.length)alert("该餐厅菜品正在整理中！");else{for(var a="",r=0;r<i.length;r++)a+='<div class="swiper-slide"><a href="javascript:;">'+i[r].name+"</a></div>";$(".swiper-wrapper").html(a),menuSlide(),$(".swiper-slide").eq(0).addClass("cur"),$(".menu-list").html(e(0)),$("#menu_sum").html($("#menu_list li").length),$.ajax({type:"get",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/all/list?restaurantId="+rId,dataType:"json",success:function(t){function e(t,e){for(var s=$("#menu_list .menu-items .btn-plus"),i=0;i<$("#menu_list .menu-items .btn-plus").length;i++){var a=s.eq(i).attr("did");a==t&&$("#menu_list .menu-items .btn-plus").eq(i).siblings(".menu-num").html(n[e].shopCart.quantity)}}if(t.succeed){var n=t.value.shopCarts;for(r=0;r<n.length;r++){var s=n[r].shopCart.dishId,i=r;e(s,i)}t.value.sumQuantity>0&&($(".sum-num").html(t.value.sumQuantity),$(".sum-num").show(),$("#btn_ordered_ok").show()),$(".sum-price").html(t.value.sumPrice),t.value.sumPrice>0&&($(".sum-num").show(),$("#btn_ordered_ok").show())}}})}$(".swiper-slide").click(function(){function t(t,e,n){var s={menuItemId:t,dishId:e,quantity:n,restaurantId:rId,platformId:3};$.ajax({type:"post",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/add",data:JSON.stringify(s),dataType:"json",succees:function(t){},error:function(){}})}$(".swiper-slide").removeClass("cur"),$(this).addClass("cur"),$("#menu_list").html(e($(this).index())),$.ajax({type:"get",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/all/list?restaurantId="+rId,dataType:"json",success:function(t){function e(t,e){for(var s=$("#menu_list .menu-items .btn-plus"),i=0;i<$("#menu_list .menu-items .btn-plus").length;i++){var a=s.eq(i).attr("did");a==t&&$("#menu_list .menu-items .btn-plus").eq(i).siblings(".menu-num").html(n[e].shopCart.quantity)}}if(t.succeed){var n=t.value.shopCarts;for(r=0;r<n.length;r++){var s=n[r].shopCart.dishId,i=r;e(s,i)}t.value.sumQuantity>0&&($(".sum-num").html(t.value.sumQuantity),$(".sum-num").show(),$("#btn_ordered_ok").show()),$(".sum-price").html(t.value.sumPrice)}}}),$(".btn-plus").click(function(){var e=parseInt($(this).siblings(".menu-num").html());e++,$(this).siblings(".menu-num").html(e);var n=$(".sum-num").html();n++,$(".sum-num").html(n);var s=parseFloat($(".sum-price").html()),i=parseFloat($(this).siblings(".menu-price").html());s=(s+i).toFixed(2),$(".sum-price").html(s);var a=$(this).attr("mid"),r=$(this).attr("did");t(a,r,1)}),$(".btn-minus").click(function(){var e=parseInt($(this).siblings(".menu-num").html());e>0&&e--,$(this).siblings(".menu-num").html(e);var n=$(".sum-num").html();n--,$(".sum-num").html(n);var s=parseFloat($(".sum-price").html()),i=parseFloat($(this).siblings(".menu-price").html());s=(s-i).toFixed(2),$(".sum-price").html(s);var a=$(this).attr("mid"),r=$(this).attr("did");t(a,r,-1)}),$("#menu_sum").html($("#menu_list li").length)}),$(".btn-next").click(function(){for(var t=0;t<$(".swiper-slide").length;t++)if($(".swiper-slide").eq(t).prop("class").indexOf("cur")>=0){var e=t;if(e++,e<$(".swiper-slide").length)return n(e),!1}}),$(".btn-prev").click(function(){for(var t=0;t<$(".swiper-slide").length;t++)if($(".swiper-slide").eq(t).prop("class").indexOf("cur")>=0){var e=t;if(e--,e>=0)return n(e),!1}}),$("#menu_list li img").click(function(){$(".m-menu-con").show(),popup_middle($("#menu_con")),$(".mask-img").prop("src",$(this).prop("src")),$(".mask-tit").html($(this).next().html()),$(".mask-price").html($(this).next().next().children(".menu-price").html()),$(".mask-num").html($(this).next().next().children(".menu-num").html()),$(".menu-bd .btn-plus").attr("mid",$(this).next().next().children(".btn-plus").attr("mid")),$(".menu-bd .btn-plus").attr("did",$(this).next().next().children(".btn-plus").attr("did")),$(".menu-bd .btn-minus").attr("mid",$(this).next().next().children(".btn-minus").attr("mid")),$(".menu-bd .btn-minus").attr("did",$(this).next().next().children(".btn-minus").attr("did")),$(".m-mask-ordered").show(),$(".m-menu-con").show()}),$(".btn-close").click(function(){$(".m-mask-ordered").hide(),$(".m-menu-con").hide()}),$(".btn-plus").click(function(){var t=parseInt($(this).siblings(".menu-num").html());t++,$(this).siblings(".menu-num").html(t);var e=$(".sum-num").html();e++,$(".sum-num").html(e);var n=parseFloat($(".sum-price").html()),i=parseFloat($(this).siblings(".menu-price").html());n=(n+i).toFixed(2),$(".sum-price").html(n),n>0&&($(".sum-num").show(),$("#btn_ordered_ok").show());var a=$(this).attr("mid"),r=$(this).attr("did");s(a,r,1)}),$(".btn-minus").click(function(){var t=parseInt($(this).siblings(".menu-num").html());t>0&&t--,$(this).siblings(".menu-num").html(t);var e=$(".sum-num").html();e--,$(".sum-num").html(e);var n=parseFloat($(".sum-price").html()),i=parseFloat($(this).siblings(".menu-price").html());n=(n-i).toFixed(2),$(".sum-price").html(n),n>0?($(".sum-num").show(),$("#btn_ordered_ok").show()):($(".sum-num").hide(),$("#btn_ordered_ok").hide());var a=$(this).attr("mid"),r=$(this).attr("did");s(a,r,-1)})}},error:function(){}})}$(function(){function menuSlide(){new Swiper(".swiper-container",{pagination:".swiper-pagination",slidesPerView:3,paginationClickable:!0,spaceBetween:30})}function CartSubmit(){var tType=1,sType=4,sPrice=$(".sum-price").html(),pId=3;getCart();var ItemsList=eval($("#btn_ordered_ok").attr("items")),sData={order:{transportType:tType,restaurantId:rId,type:sType,totPayAmount:sPrice,platformId:pId},items:ItemsList};$.ajax({type:"post",headers:{"x-access-token":token,"Content-Type":"application/json"},data:JSON.stringify(sData),url:"http://api.51yuchu.com/dish/order/do?resubmitToken="+token,dataType:"json",success:function(t){t.succeed&&(console.log(t),window.location.href="restaurantorderedconfirm.html#"+rId)}})}function getCart(){$.ajax({type:"get",async:!1,headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/list?restaurantId="+rId+"&page=1&size=10",dataType:"json",success:function(t){for(var e=t.value.list,n=[],s=0;s<e.length;s++)n.push({id:e[s].shopCart.id,quantity:e[s].shopCart.quantity});$("#btn_ordered_ok").attr("items",JSON.stringify(n))}})}$("#icon_back_ordered").click(function(){window.location.href="restaurantdetails.html#"+rId}),$("#btn_ordered_ok").click(function(){var t=parseFloat($(".sum-price").text());window.location.href="restaurantorderedconfirm.html#/ordered/"+rId+"/"+t}),$("#btn_cart").click(function(){$.ajax({type:"get",headers:{"x-access-token":token,"Content-Type":"application/json"},url:"http://api.51yuchu.com/cart/list?restaurantId="+rId+"&page=1&size=10",dataType:"json",success:function(t){for(var e=t.value.list,n="",s=0;s<e.length;s++)n+='<li class="menu-items"><img src="'+e[s].menuItem.previewUrl+'" alt=""><h3 class="menu-title">'+e[s].menuItem.name+'</h3><p><em>¥</em> <em class="menu-price">'+e[s].shopCart.price+'</em> <a href="javascript:;" class="btn-plus" mid="'+e[s].menuItem.menuItemId+'" did="'+e[s].menuItem.dishId+'">+</a> <strong class="menu-num">'+e[s].shopCart.quantity+'</strong> <a href="javascript:;" class="btn-minus" mid="'+e[s].menuItem.menuItemId+'" did="'+e[s].menuItem.dishId+'">-</a></p></li>';$("#cmenu_list").html(n),$("#cmenu_sum").html($("#cmenu_list li").length)}}),$(".g-box").hide(),$(".g-box-cart").show()}),$("#icon_back_cart").click(function(){window.location.href="restaurantordered.html#"+rId,$(".g-box-cart").hide(),$(".g-box").show()}),$("#btn_cart_ok").click(function(){var t=parseFloat($(".sum-price").text());window.location.href="restaurantorderedconfirm.html#/ordered/"+rId+"/"+t})});