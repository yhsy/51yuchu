function SchHotAjax(t){$.ajax({type:"get",url:"http://api.51yuchu.com/search/"+t+"/hot/keyword/list?top=10",dataType:"json",success:function(t){var a="";if(t.succeed){for(var s=0;s<t.value.length;s++)a+='<li><a href="javascript:;">'+t.value[s].key+"</a></li>";$("#sch_hot_list").html(a),$("#sch_hot_list li a").click(function(){restaurantList($(this).html())})}}})}function restaurantList(t){$("#btn_sch_close").hide(),$(".m-mask-bd").hide();var a="";$.ajax({type:"get",url:"http://api.51yuchu.com/search/restaurant/do?cityId="+cityId+"&lat="+lat+"&lng="+lng+"&keyword="+t,dataType:"json",beforeSend:Loading,success:function(t){if(t.succeed){for(var s=0;s<t.value.length;s++)a=a+'<li class="m-restaurant"><a href="restaurantdetails.html#'+t.value[s].restaurant.id+'"class="m-restaurant-img"><img src="'+t.value[s].restaurant.previewUrl+'"alt=""></a><a href="restaurantdetails.html#'+t.value[s].restaurant.id+'" class="m-restaurant-text"><h3 class="m-restaurant-tit">'+t.value[s].restaurant.name+'</h3><p class="m-restaurant-region">'+t.value[s].country.name+'</p><p class="m-restaurant-price">'+t.value[s].restaurant.priceStr+'</p></a><div class="m-restaurant-evaluate"><img src="images/bg-pie.png"alt=""><div class="m-evaluate-con"><h4>好评率</h4><p class="m-evaluate-ratio">'+t.value[s].praisePrecent+'％</p><p class="m-evaluate-votes">'+t.value[s].commentAssessment+"&nbsp;票</p></div></div></li>";$("#restaurant_list").html(a)}}})}function Loading(t){$(".m-loading").remove(),$(".g-restaurant").before("<div class='m-loading'><img src='images/loading.gif' /><div>"),$("#restaurant_list").hide(),setTimeout(function(){$(".m-loading").hide(),$("#restaurant_list").show()},500)}var user=store.get("user"),lng=user.lng,lat=user.lat,cityId=user.cityId,httpUrl=window.location.hash;if(httpUrl.length>0?($(".m-country-tab2 li").removeClass("tab-active"),$(".m-country-tab2 li:last").addClass("tab-active"),console.log($(".m-country-tab2 li:last").html()),SchHotAjax("dish")):SchHotAjax("restaurant"),store.get("history")){for(var strHis=store.get("history"),strHisList="",i=0;i<strHis.length;i++)strHisList+='<li><a href="javascript:;">'+strHis[i]+"</a></li>";$(".sch-history-list").html(strHisList)}else $(".sch-history-list").hide();$(function(){setTimeout(function(){try{var t=$("#search_ipt");t.focus(),t.select()}catch(t){}},200),$("#search_ipt").bind("keyup",function(t){if($("#btn_sch_close").show(),$(this).val().length>=1&" "!==$(this).val()){var a="";$.ajax({type:"get",url:"http://api.51yuchu.com/search/restaurant/do?cityId="+cityId+"&lat="+lat+"&lng="+lng+"&keyword="+$("#search_ipt").val(),dataType:"json",success:function(s){for(var e=0;e<s.value.length;e++)a=a+'<li class="sch-think"><i class="icon-schs"></i><span class="u-restaurant-name">'+s.value[e].restaurant.name+"</span></li>";if($(".m-mask-bd").show(),$("#think_list").html(a),$(".sch-think").click(function(){restaurantList($(this).children("span").html())}),store.get("history"))var i=store.get("history");else var i=[];var r=0;"13"==t.keyCode&&(r++,i.push($("#search_ipt").val()),store.set("history",i),restaurantList($("#search_ipt").val()))}})}}),$("#btn_sch_close").click(function(){$("#search_ipt").val(""),$(this).hide(),$("#think_list").html(""),$(".m-mask-bd").hide()}),$("#sch_restaurant").click(function(){SchHotAjax("restaurant")}),$("#sch_cate").click(function(){SchHotAjax("dish")})});