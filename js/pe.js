function uCode(){var e=window.location.search,t=e.split("="),o=t[1].split("&"),a=o[0];return a}if(window.location.search){var wxCode=uCode();$.ajax({type:"post",contentType:"application/json",url:"http://api.51yuchu.com/login/fwh",data:JSON.stringify({code:wxCode}),dataType:"json",success:function(e){if(e.succeed){var t=e.value;store.set("wxToken",t),$.ajax({type:"get",headers:{"x-access-token":t},url:"http://api.51yuchu.com/vip/get",dataType:"json",success:function(e){if(e.succeed){$(".personal-name").html(e.value.name),$(".personal-img").prop("src",e.value.headImageUrl);var t=store.get("user");$(".personal-city").html(t.cityName)}},error:function(){alert("返回token失败")}})}},error:function(){alert("返回失败")}})}else{var user=store.get("user"),url="http://"+window.location.host+"/";store.get("wxToken")?$.ajax({type:"get",headers:{"x-access-token":store.get("wxToken")},url:"http://api.51yuchu.com/vip/get",dataType:"json",success:function(e){if(e.succeed){$(".personal-name").html(e.value.name),$(".personal-img").prop("src",e.value.headImageUrl);var t=store.get("user");$(".personal-city").html(t.cityName)}},error:function(){alert("返回token失败")}}):$.ajax({type:"get",url:"http://api.51yuchu.com/wechat/fwh/get/config?url="+url,dataType:"json",success:function(e){if(e.succeed){console.log(e);var t=e.value,o=t.appId,a=(t.timestamp,t.nonceStr,t.signature,t.url+"personal.html"),r="snsapi_userinfo";window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+o+"&redirect_uri="+a+"&response_type=code&scope="+r+"#wechat_redirect"}}})}$(function(){});